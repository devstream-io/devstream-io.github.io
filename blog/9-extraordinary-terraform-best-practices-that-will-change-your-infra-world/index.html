<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.96.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>9 Extraordinary Terraform Best Practices That Will Change Your Infra World | DevStream</title><meta name=description content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta property="og:title" content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta property="og:description" content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta property="og:type" content="article"><meta property="og:url" content="https://www.devstream.io/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/"><meta property="og:image" content="https://www.devstream.io/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/featured-background.jpg"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-04-12T00:00:00+00:00"><meta property="article:modified_time" content="2022-04-12T10:12:02+08:00"><meta property="og:site_name" content="DevStream"><meta itemprop=name content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta itemprop=description content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta itemprop=datePublished content="2022-04-12T00:00:00+00:00"><meta itemprop=dateModified content="2022-04-12T10:12:02+08:00"><meta itemprop=wordCount content="3139"><meta itemprop=image content="https://www.devstream.io/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/featured-background.jpg"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.devstream.io/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/featured-background.jpg"><meta name=twitter:title content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><meta name=twitter:description content="9 Extraordinary Terraform Best Practices That Will Change Your Infra World"><link rel=preload href=/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css as=style><link href=/scss/main.min.209ee91954d0f2f182770e6c71011a5580360636bcf2a9bcf7f1c3da478784ff.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-00000000-0","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="td-page td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class=navbar-logo><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=font-weight-bold>DevStream</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/blog/><span class=active>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://github.com/devstream-io/devstream target=_blank><span>GitHub</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://docs.devstream.io/en/latest/ target=_blank><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://medium.com/devstream target=_blank><span>Medium</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=https://dev.to/devstream target=_blank><span>Dev.to</span></a></li><li class="nav-item dropdown mr-4 d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-docs-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="collapse td-sidebar-nav" id=td-section-nav><div class="nav-item dropdown d-block d-lg-none"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>English</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/zh/>中文</a></div></div><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-blog-li><a href=/blog/ title="DevStream Blog" class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-blog><span>Blog</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-bloghow-to-li><a href=/blog/how-to/ title="How-to About DevStream" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-bloghow-to><span>How-To</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcreating-a-devstream-dtm-plugin-for-anything-li><a href=/blog/creating-a-devstream-dtm-plugin-for-anything/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blogcreating-a-devstream-dtm-plugin-for-anything><span>Creating a DevStream (dtm) Plugin for Anything</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-bloghello-world-li><a href=/blog/hello-world/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-bloghello-world><span>Hello, World</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogcommunity-li><a href=/blog/community/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blogcommunity><span>Community</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-blogreleases-li><a href=/blog/releases/ title="New Releases" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-blogreleases><span>Releases</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogv040-release-note-li><a href=/blog/v0.4.0-release-note/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blogv040-release-note><span>v0.4.0 Release Note</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogv031-release-note-li><a href=/blog/v0.3.1-release-note/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blogv031-release-note><span>v0.3.1 Release Note</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-bloginfrastructure-as-code-li><a href=/blog/infrastructure-as-code/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-bloginfrastructure-as-code><span>Infrastructure as Code</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-blog9-extraordinary-terraform-best-practices-that-will-change-your-infra-world-li><a href=/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/ title="9 Extraordinary Terraform Best Practices That Will Change Your Infra World" class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-blog9-extraordinary-terraform-best-practices-that-will-change-your-infra-world><span class=td-sidebar-nav-active-item>9 Terraform Best Practices</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-bloggeneral-li><a href=/blog/general/ title="General Articles" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-bloggeneral><span>General</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-blogdagger-the-cicd-tool-not-the-knife-in-depth-everything-you-need-to-know-as-of-apr-2022-li><a href=/blog/dagger-the-ci/cd-tool-not-the-knife-in-depth-everything-you-need-to-know-as-of-apr-2022/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-blogdagger-the-cicd-tool-not-the-knife-in-depth-everything-you-need-to-know-as-of-apr-2022><span>Dagger (the CI/CD Tool, not the Knife) In-Depth: Everything You Need to Know (as of Apr 2022)</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/devstream-io/website/tree/main/content/en/blog/infrastructure-as-code/9-terraform-best-practices/index.md class=td-page-meta--view target=_blank rel=noopener><i class="fa fa-file-alt fa-fw"></i> View page source</a>
<a href=https://github.com/devstream-io/website/edit/main/content/en/blog/infrastructure-as-code/9-terraform-best-practices/index.md class=td-page-meta--edit target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/devstream-io/website/new/main/content/en/blog/infrastructure-as-code/9-terraform-best-practices/index.md?filename=change-me.md&value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class=td-page-meta--child target=_blank rel=noopener><i class="fa fa-edit fa-fw"></i> Create child page</a>
<a href="https://github.com/devstream-io/website/issues/new?title=9%20Extraordinary%20Terraform%20Best%20Practices%20That%20Will%20Change%20Your%20Infra%20World" class=td-page-meta--issue target=_blank rel=noopener><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/devstream-io/devstream/issues/new class=td-page-meta--project-issue target=_blank rel=noopener><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#1-clean-code>1 Clean Code</a><ul><li><a href=#11-on-code>1.1 On &ldquo;Code&rdquo;</a></li><li><a href=#12-code-evolving-code>1.2 Code, Evolving Code</a></li><li><a href=#13-writing-clean-code>1.3 Writing Clean Code</a></li><li><a href=#14-write-clean-terraform-code>1.4 Write Clean Terraform Code</a></li></ul></li><li><a href=#2-know-your-stuff>2 Know Your Stuff</a><ul><li><a href=#21-play-with-it-first>2.1 Play with It First</a></li><li><a href=#22-know-your-infrastructure>2.2 Know Your Infrastructure</a></li></ul></li><li><a href=#3-the-myth-of-future-proof>3 The Myth of Future-Proof</a></li><li><a href=#4-do-one-thing-and-do-it-right>4 Do One Thing and Do It Right</a></li><li><a href=#5-the-art-of-finding-the-balance-dry-vs-readability>5 The Art of Finding the Balance: DRY V.S. Readability</a></li><li><a href=#6-separate-infrastructure-with-configuration>6 Separate Infrastructure with Configuration</a><ul><li><a href=#61-a-story>6.1 A Story</a></li><li><a href=#62-whats-infrastructure-as-code-iac>6.2 What&rsquo;s Infrastructure as Code (IaC)</a></li><li><a href=#63-whats-configuration-management-cm>6.3 What&rsquo;s Configuration Management (CM)</a></li><li><a href=#64-the-iac-and-cm-separation>6.4 The IaC and CM Separation</a></li></ul></li><li><a href=#7-make-your-terraform-code-idempotent>7 Make Your Terraform Code Idempotent</a></li><li><a href=#8-make-your-terraform-code-declarative>8 Make Your Terraform Code Declarative</a></li><li><a href=#9-forget-about-cloud-agnostic--vendor-lock-in>9 Forget about Cloud Agnostic / Vendor Lock-in</a></li><li><a href=#summary>Summary</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><a class="btn btn-lg -bg-orange td-rss-button d-none d-lg-block" href=https://www.devstream.io/blog/infrastructure-as-code/index.xml target=_blank>RSS <i class="fa fa-rss ml-2"></i></a><div class=td-content><h1>9 Extraordinary Terraform Best Practices That Will Change Your Infra World</h1><div class=lead>9 Extraordinary Terraform Best Practices That Will Change Your Infra World</div><div class="td-byline mb-4">By <b>Tiexin Guo (<a href=https://github.com/IronCore864>@IronCore864</a>)</b> |
<time datetime=2022-04-12 class=text-muted>Tuesday, April 12, 2022</time></div><header class=article-meta></header><p><em>Note: this article is orignally published at <a href=https://blog.gitguardian.com/9-extraordinary-terraform-best-practices/>GitGuardian Blog</a>.</em></p><p>Before you quickly glance over the title and think &ldquo;Oh god, yet another tutorial on how to give proper names to variables, how to use modules, how to manage states; nothing I haven&rsquo;t already know&rdquo; then close the tab right away, let me assure you this: this article is none of those.</p><p>This &ldquo;best practices&rdquo; article aims to tell you something you haven&rsquo;t read a hundred times. This article won&rsquo;t give you the answer to everything because there isn&rsquo;t one right answer that fits all. This article aims to make you think about your unique situation and make the best decisions by you and for you.</p><p>Without further adieu, let&rsquo;s start with writing Terraform code:</p><div class="card rounded p-2 td-post-card mb-4 mt-4" style=max-width:1210px><img class=card-img-top src=/blog/9-extraordinary-terraform-best-practices-that-will-change-your-infra-world/featured-background_hue3380180632e3277a681d06ca14cda6b_666339_1200x800_fill_q75_catmullrom_smart1.jpg width=1200 height=800><div class="card-body px-0 pt-2 pb-0"><p class=card-text>Pidu District, Chengdu, China.
<small class=text-muted><br>Photo: Tiexin Guo / CC-BY-CA</small></p></div></div><hr><h2 id=1-clean-code>1 Clean Code</h2><p>No tool or programming language is perfect, and Terraform is no different. It has limitations.</p><p>For example, for old Terraform users from 0.12 or even earlier age, you might remember that before Terraform 0.13, you can&rsquo;t even use <code>for_each</code> for modules. In August 2020, with the release of Terraform 0.13, HashiCorp finally introduced the ability to loop over modules with a single module call.</p><p>Once you have accepted the quirks and features, you can utilize a bunch of best practices to organize your code and to use it better. Even though Terraform isn&rsquo;t strictly a programming language, similar rules of writing code apply to Terraform as well.</p><p>But before we talk about Terraform code, let&rsquo;s have a quick look at coding or programming in general.</p><h3 id=11-on-code>1.1 On &ldquo;Code&rdquo;</h3><p>I want to start this conversation by quoting Knuth:</p><blockquote><p>Programs are meant to be read by humans and only incidentally for computers to execute.</p></blockquote><p>The computer has no problem with ambiguous variable names, extended functions, or a single file of thousands of lines of code. It will still execute properly. All the methodologies and ideas like refactoring, clean code, naming conventions, modules, packages, code smell, etc., are invented so that we <em>humans</em> can read the code better, not computers can run it better.</p><h3 id=12-code-evolving-code>1.2 Code, Evolving Code</h3><p>Programs evolve. Code changes.</p><p>It&rsquo;s rare that you finished a piece of code and leave it there for the rest of your life. But that&rsquo;s not how projects work. If that was the case, we wouldn&rsquo;t be talking about Terraform best practices: you would only use it once anyway.</p><p>It&rsquo;s normal that when we are at work, we have projects all the time. The time when there isn&rsquo;t any project is scarce. Because business wants to improve, and the project is the way to move from the current state to the next desired state. Changing from one state to another is &ldquo;project&rdquo;. By Nature, &ldquo;project&rdquo; means change, and the code is also changing constantly.</p><h3 id=13-writing-clean-code>1.3 Writing Clean Code</h3><p>In order to make the change more manageable, we write clean code.</p><p>We limit the length of the line width because humans are not good at reading very wide lines of words; we carefully choose the names of the variables so that we immediately know what it means the next time we read it; we try to reduce the length of functions because shorter functions are not only easier to test but also easier to understand; we try to split a file with thousands of lines of code into smaller chunks.</p><p>Computers don&rsquo;t care about any of these, at all. Be it one large file or ten smaller chunks of files, it will run. Clean code makes it easier and faster to read, to understand, to build upon it.</p><p>You may already understand where I&rsquo;m going with this, and you are right: we want to do whatever it is so that our code is easier to read, manage, and change.</p><h3 id=14-write-clean-terraform-code>1.4 Write Clean Terraform Code</h3><p>I don&rsquo;t need to tell you how to name your variables, why it&rsquo;s a bad practice to name a server &ldquo;test-server&rdquo; while it&rsquo;s in the production environment, should you add a tag to a resource or not, etc.</p><p>Use your best judgment.</p><p>Do whatever it is to make the code manageable (or just Google and read any other available Terraform best practices out there.)</p><hr><h2 id=2-know-your-stuff>2 Know Your Stuff</h2><h3 id=21-play-with-it-first>2.1 Play with It First</h3><p>For people who are new to the cloud or new to a specific service in the cloud, I don&rsquo;t recommend using Terraform as the first attempt to create that resource. This is true no matter which IaC tool you are using, not specific to Terraform.</p><p>First, go to the console, try things manually, read the official documents and FAQs, figure out what parameters are mandatory and what are optional, and what are the possible values for each specific parameter. This would definitely help. Don&rsquo;t worry because some big guy in the DevOps world told you that &ldquo;the moment you click a button in the console, you create technical debt.&rdquo; Forget about it. Get comfortable with it first.</p><p>Once you grasp the keys of the resource you are going to create, you can automate it using Terraform.</p><p>For experienced Terraform users, see if this relates to you: AWS released a new service or a new resource. You haven&rsquo;t used it yet. You tell yourself: &ldquo;I&rsquo;m a veteran; only noob plays with console. I&rsquo;ll just get started with a perfect Terraform module right away. Why bother playing with it in the console first anyway?&rdquo; Then after hours of working and debugging, you find out that you are stuck only because of a small parameter or configuration of the resource which you didn&rsquo;t figure out clearly in the first place.</p><h3 id=22-know-your-infrastructure>2.2 Know Your Infrastructure</h3><p>You need to know what exactly is created and managed by your Terraform code.</p><p>This is especially important when using third-party modules because there are so many parameters and different use cases, it&rsquo;s hard to know exactly which scenario to pick, what resources will be created, and what values to set for those bunch of parameters.</p><p>Oftentimes, when I need to provision some resources in the cloud using Terraform, I find that I can do it quicker if I write the resources and modules myself (of course, I could also re-use modules I wrote before) than finding a third-party module off the internet because a lot of third-party modules are heavily future-proofed; they try to solve everybody&rsquo;s problem with the same module: they are doing it the &ldquo;monolithic&rdquo; way.</p><p>Here I don&rsquo;t mean to assign blame to anybody, but for example, if you try to search a module, like EKS, from Terraform registry, you will find out that it has a whopping 62 input parameters. If you want to create an EKS cluster in an existing VPC, using self-managed worker nodes, with certain launch templates, what parameters to set? Have fun figuring that out.</p><p>Sometimes, &ldquo;do not re-use the wheel&rdquo; is the better way to go: Terraform isn&rsquo;t easy to get started, but once you get fluent with it, it&rsquo;s relatively easy to use. Creating a resource or a module isn&rsquo;t rocket science. You can manage it within a reasonable period of time. Weigh the advantages and disadvantages of using third-party modules before you decide.</p><hr><h2 id=3-the-myth-of-future-proof>3 The Myth of Future-Proof</h2><p>When you only need one feature, implement one, don&rsquo;t even try to implement another feature you might use in the future. Premature future-proof or over-future-proof generates not-so-clean code. This is also true even if you are using another Infrastructure as Code tool other than Terraform.</p><p>Many &ldquo;best practices&rdquo; would tell you to never use a local backend, always use a remote backend, run your Terraform from within a CI tool, always use modules, etc.</p><p>I&rsquo;m telling you none of those.</p><p>Because <em>there is no &ldquo;one-size-fits-all&rdquo; answer; it all depends.</em></p><p>For a simple example, if I&rsquo;m working with a minimum viable product (MVP) or even a proof of concept (POC), why bother wasting time creating a remote state with state lock and executing the job from a CI running in K8s in the cloud and creating ridiculously small modules just to have modules because others told you it&rsquo;s &ldquo;best practice&rdquo; to do so?</p><p>You can&rsquo;t possibly know what you exactly are going to need in the future. Chances are, even if you did some future-proof work, created some perfect module, and set up perfect remote state management, in the future, when you really need to use it, you would probably refactor it anyway. It&rsquo;s not like creating a module is hard. It isn&rsquo;t; it&rsquo;s not rocket science.</p><p>When you try to future-proof your code, you write if-else. You write conditions and branches so that your code could work for more than one scenario. Refactor is all about reducing if-else and simplifying the code. Why introduce complexity when you don&rsquo;t really need it now?</p><p>But hey, don&rsquo;t get me wrong: I&rsquo;m not telling you to give up modules and remote states and some fancy features and what have you; the point is, creating a flexible base so that it could adapt to possible future changes, but don&rsquo;t waste too much time and energy future-proofing it.</p><hr><h2 id=4-do-one-thing-and-do-it-right>4 Do One Thing and Do It Right</h2><p>Just like the example given in the previous section, there are too many examples of Terraform modules and code that try to be the &ldquo;complete package&rdquo; by supporting every single possible scenario.</p><p>For experienced Terraform users, you might already be familiar with this: to make your module &ldquo;complete&rdquo; and useful in every scenario, you use complicated input variable structure, you create even more complicated local variables with short-hand conditions, you even need to use built-in functions to merge multiple variables as one so that if one variable is empty, you can still get the value from another variable and no exception would be thrown.</p><p>For starters, when you look at the code like this, it&rsquo;s not &ldquo;declarative&rdquo; anymore, because when you read something as complicated as that, you can&rsquo;t really know the description of the infrastructure that you are going to create with that code, you can&rsquo;t know what value is being set to this specific parameter.</p><p>Maybe writing a module for a specific scenario isn&rsquo;t that bad. When you have a slightly different use case, create another module. This might generate duplicated code, so you need to:</p><hr><h2 id=5-the-art-of-finding-the-balance-dry-vs-readability>5 The Art of Finding the Balance: DRY V.S. Readability</h2><p>DRY means Don&rsquo;t Repeat Yourself, and this principle is loved by many programmers.</p><p>Yet, you also have to find the right balance between &ldquo;duplicated code&rdquo; and &ldquo;readability.&rdquo; This is also true for any programming language because code is for humans to read.</p><p>When you want to achieve two things in one piece of code, you will need extra input parameters. You will need if-else. You will need to generate various outputs too. Adding too many features into one piece of code will invariably reduce the readability because brains are not so great with if-else and parameters.</p><p>On the other hand, you can choose to have two pieces of code for two slightly different features, with both having straight-forward logic flow and easy to read, but in this way, you probably will have some duplicated code. Using the right technique, for example, extracting the similar part out and creating a small module for it (if it will be commonly used) might be an answer.</p><p>Finding the right balance between duplicated code and readability is an art that requires experience to be made perfect, and only you can decide for yourself. &ldquo;You must have less than 10% duplicated code&rdquo; or &ldquo;reuse modules as much as possible&rdquo; are simply not pragmatic or helpful suggestions.</p><hr><h2 id=6-separate-infrastructure-with-configuration>6 Separate Infrastructure with Configuration</h2><h3 id=61-a-story>6.1 A Story</h3><p>Once, I was in a project where we use IaC to create Kubernetes clusters; then, some customization is done on top of it to install required components inside the cluster.</p><p>In that project, Terraform is used, then Terraform Kubernetes provider is also used to install things inside the cluster. So far, so good, because Terraform is idempotent (more on that later) by design.</p><p>The thing is, if a certain resource is already in the cluster, like a ConfigMap, the Kubernetes provider can&rsquo;t &ldquo;upsert&rdquo; it, and it would fail because it already existed. The provider breaks the idempotency.</p><p>This is an example of why you want to separate your IaC part from the configuration management part because not only does it make sense logically, but also it reduces the complexity.</p><p>In the example above, if we used Terraform only to create the cluster and nothing else, then use CI/CD tools to do <code>kubectl apply</code>, there would be no trouble at all.</p><h3 id=62-whats-infrastructure-as-code-iac>6.2 What&rsquo;s Infrastructure as Code (IaC)</h3><p>Infrastructure as Code (IaC) manages infrastructure in a descriptive model:</p><ul><li>It uses code files as the definition rather than interactive tools.</li><li>It tries to achieve 100% automation.</li><li>It doesn&rsquo;t matter if you run your own data center or you use the public cloud.</li></ul><p>You write code to manage your networks, servers (physical servers or virtual machines), connections, connection topology, load balancers, etc.</p><h3 id=63-whats-configuration-management-cm>6.3 What&rsquo;s Configuration Management (CM)</h3><p>Configuration Management (CM), on the other hand, maintains computer systems, software, dependencies, settings, etc., in a desired, consistent state.</p><p>Think physical data center as another example: purchasing servers, putting a newly purchased server onto a rack, installing servers, connecting networking cables to the switches so that it&rsquo;s connected to the existing networks (or think of launching a new virtual machine and assigning network interfaces to it) belongs to the definition of &ldquo;infrastructure.&rdquo; These are infrastructure parts, done by specific teams. In contrast, after the server is launched, configuring the servers to run specific software, for example, installing an HTTP server software and configuring it belongs to &ldquo;configuration management&rdquo;, and it probably can be done by another team which doesn&rsquo;t need to worry about the underlying infrastructure at all.</p><h3 id=64-the-iac-and-cm-separation>6.4 The IaC and CM Separation</h3><p>In the real world, things are not as simple as the &ldquo;black or white&rdquo; example above because we have many different tools and technologies allowing us to do Infrastructure as Code, or configuration management, or both at the same time.</p><p>For example, although Terraform is considered an IaC tool, it can do some configurations and installations on certain servers. And although Ansible is considered a configuration management tool, it can launch virtual machines.</p><p>Finding the right boundary for you, figuring out which part you would like Terraform to manage, and how Terraform interacts with your choice of CM tools is crucial, especially for large projects.</p><p>In an ever-changing world, the entropy in your system is only increasing. In the long run, you will benefit greatly from &ldquo;simplify&rdquo; and &ldquo;do one thing and do it right.&rdquo;</p><hr><h2 id=7-make-your-terraform-code-idempotent>7 Make Your Terraform Code Idempotent</h2><p>Idempotent means no matter how many times you run your IaC and, what your starting state is, you will end up with the same end state.</p><p>The same principle applies to configuration management too.</p><p>Why Do We Need Idempotency?</p><p>Idempotency is nice to have because infrastructure and configuration are not getting simpler as time goes on. Even if you just started fresh, you will handle complicated situations in no time. Idempotency simplifies the provisioning of infrastructure and the management of configurations, and it reduces the chances of inconsistent results.</p><p>For example, you need to set up A, then set up B after A is finished. If setting up A failed, you want to re-run your automation so that it can retry setting up B without trying to create A again (if it tries to create A again, it will fail because A already exists).</p><p>How to make it idempotent? Read on.</p><hr><h2 id=8-make-your-terraform-code-declarative>8 Make Your Terraform Code Declarative</h2><p>To achieve idempotency, a declarative style of code is preferred in most cases.</p><p>Declarative means defining the final state you want to have, rather than what command to execute in the code.</p><p>For example, you want to install an HTTP webserver. The task should be described as &ldquo;ensure an HTTP server is installed&rdquo; (i.e., if the HTTP server isn&rsquo;t installed, install it; if already installed, do nothing), instead of &ldquo;run this apt command to install the server.&rdquo;</p><p>When you look at your Infrastructure as Code, it should be like reading a document, a description of what you will have if you run this code, no matter how many times you run it.</p><p>When writing your infrastructure code or even creating a Terraform provider, you need to have &ldquo;side effects&rdquo; in mind. If this part runs a shell command or script, what happens if I run &ldquo;terraform apply&rdquo; again?</p><hr><h2 id=9-forget-about-cloud-agnostic--vendor-lock-in>9 Forget about Cloud Agnostic / Vendor Lock-in</h2><p>This might be controversial, but I&rsquo;d like to make it clear: Terraform isn&rsquo;t &ldquo;Cloud-Agnostic&rdquo;, and vendor lock-in doesn&rsquo;t matter (at least it not as much as you might think.)</p><p>In many cases, people are fighting hard to avoid vendor lock-in. Because we want to have a &ldquo;backup plan&rdquo; if things don&rsquo;t work out nicely with the current vendor. We want to have the option of moving to another vendor with as little trouble as possible.</p><p>It&rsquo;s not the case in the real world.</p><p>When you buy servers in bulk, you probably sign multi-year contracts with the vendor for a better price. When you are using the cloud, you rarely decide to move to another cloud. Having a multi-cloud setup, maybe yes, but migrating from one cloud to another isn&rsquo;t common, although situations like that do exist.</p><p>Even if you want to use Terraform to manage your AWS resource because you might want to move to GCP or Azure in the future, and you know Terraform works with GCP and Azure, in reality, you can&rsquo;t re-use your code. It goes without saying that if you want to switch from one cloud to another, you need to rewrite all your Terraform code: different cloud has different Terraform providers, and their resource name and parameters differ greatly.</p><p>Admit it or not, you are vendor locked-in, one way or another.</p><p>Once you are clear of this, it&rsquo;s, in fact, easier for you to choose the right tool for the job: because you are not afraid of vendor lock-in anymore, and you don&rsquo;t put it as the top priority one when making comparisons. Instead, you start to see the features, advantages, and disadvantages of each choice. For example, if you are already using Terraform with AWS, but for this specific piece of infrastructure, it might be even easier to use AWS CDK or some other tool (for example, <code>eksctl</code> to create a K8s cluster), why not?</p><h2 id=summary>Summary</h2><p>With a not-so-flat learning curve, Terraform can be intimidating, but once mastered, it provides you enough flexibility to manage your infrastructure. There are pitfalls and issues if you don&rsquo;t use it properly, but with some care and continuous refactoring, it can be manageable, and the code can be kept clean and easy to read. I hope these &ldquo;best practices&rdquo; help!</p><ul class="list-unstyled d-flex justify-content-between align-items-center mb-0 pt-5"><li><a class="btn btn-primary disabled"><span class=mr-1>←</span>Previous</a></li><a class="btn btn-primary disabled">Next<span class=ml-1>→</span></a></li></ul></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="User mailing list" aria-label="User mailing list"><a class=text-white target=_blank rel=noopener href=https://example.org/mail aria-label="User mailing list"><i class="fa fa-envelope"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Twitter aria-label=Twitter><a class=text-white target=_blank rel=noopener href=https://example.org/twitter aria-label=Twitter><i class="fab fa-twitter"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://example.org/stack aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/devstream-io/devstream aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=Slack aria-label=Slack><a class=text-white target=_blank rel=noopener href=https://example.org/slack aria-label=Slack><i class="fab fa-slack"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://example.org/mail aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 DevStream Community All Rights Reserved</small>
<small class=ml-1><a href=https://xxx target=_blank rel=noopener>Privacy Policy</a></small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.7aa764d41598f3ae2d75328dec2bf5fa47be3f2e92011bb6b24b25ba3eabca52.js integrity="sha256-eqdk1BWY864tdTKN7Cv1+ke+Py6SARu2sksluj6rylI=" crossorigin=anonymous></script></body></html>